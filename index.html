<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <link rel="stylesheet" href="main.css" />
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #video {
        position: fixed;
        left: 0;
        bottom: 0;
      }

      #blocker {
        position: absolute;
        text-align:center;
        width: 100%;
        height: 100%;
        padding-left: 10%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      #secondBlocker {
        position: absolute;
        font-family:"Comic Sans MS", "Comic Sans", cursive;
        width: 88%;
        height: 5%;
        margin: 5%;
        margin-top:2%;
        font-size: 3vh;
        text-align: center;
        color: #ffffffcc;
        background-color: rgba(0, 0, 0, 0);
      }
    </style>
    <title>Planetary System</title>
  </head>

  <body>
    <div id="container"></div><div id="esc"></div>
    <div id="secondBlocker" style="display: none">
      Press W A S D to move, Shift to speed up. Use Mouse to look around.
      Press ESC to disable mouse direction.</br>Press P/O to speed up/down the plants rotation and moving!&nbsp;&nbsp;&nbsp;Current speed: <span id="plantspeed"></span>%
    </br>
    Smash the Space, and then a meteorite will show up!&nbsp;&nbsp;&nbsp;Meteorites: <span id="meteorite"></span>
    </div>
    <div id="blocker">
      <div id="content">
        <h1>Explore the Galaxy</h1>
        <p>
          A galaxy is a gravitationally bound system of stars, stellar
          remnants, interstellar gas, dust, and dark matter. The galaxies in the
          Universe are constantly changing – through secular evolution, mergers
          and interactions. They are mysterious!
        </p><p>
          Go to a galaxy, and explore its secrets!
        </p>
        <a class="btn" onclick="hideMe()">START EXPLORATION</a>
      </div>
    </div>
  </body>

  <script src="./three.js/build/three.js"></script>
  <script src="./JS/jquery.js"></script>

  <script type="module">
    import {
      Lensflare,
      LensflareElement,
    } from "./three.js/examples/jsm/objects/Lensflare.js";
    var display = document.getElementById("content").style.display;
    var scene;
    var camera;
    var renderer;
    var rotatespeed = 5;

    var moveForward = false;
    var moveBackward = false;
    var moveLeft = false;
    var moveRight = false;
    var jump = false;
    var fast = false;
    var esc = true;
    var speedup=false;
    var speeddown=false;
    var addmet=false;
    var meteorites=[];

    var color = new THREE.Color();
    var spotLight;

    var cameraPosition = new THREE.Vector3(0, 150, 1500);
    var cameraDirection = new THREE.Vector3(0, 0, 0);

    var SEPARATION = 210,
      AMOUNTX = 30,
      AMOUNTY = 30,
      AMOUNTZ = 10;
    var particles,
      particle,
      randomstar,
      count = 0;

    const sunlight = new THREE.TextureLoader().load("img/lensflare2.png");
    var sunmaterial = new THREE.SpriteMaterial({ map: sunlight });
    const sunbackground = new THREE.Sprite(sunmaterial);
    sunbackground.position.set(0, 0, 0);
    sunbackground.scale.set(450, 360, 1);
    const sunlight1 = new THREE.TextureLoader().load("img/lensflare1.png");
    var sunmaterial1 = new THREE.SpriteMaterial({ map: sunlight1 });
    const sunbackground1 = new THREE.Sprite(sunmaterial1);
    sunbackground1.position.set(0, 0, 0);
    sunbackground1.scale.set(380, 280, 1);

    var sun = obj_lighting("./texture/j025.jpg", 100, 0, 0, 0);
    var star1 = obj("./texture/j022.jpg", 8, 200, 0, 0);
    var star2 = obj("./texture/j006.jpg", 12, 300, 0, 0);
    var star3 = obj("./texture/j011.jpg", 20, 500, 0, 0);
    var starlite3 = obj("./texture/j029.jpg", 3, 525, 30, 0);
    var star4 = obj("./texture/j008.jpg", 25, 800, 0, 0);
    var ring4 = ring1("./texture/ring6.png", 30, 25, 800, 0, 0);
    var star5 = obj("./texture/j016.jpg", 30, 1100, 0, 0);
    var star6 = obj("./texture/j021.jpg", 35, 1500, 0, 0);
    var starlite6 = obj("./texture/j024.jpg", 4, 1555, 30, 0);
    var star7 = obj("./texture/j009.jpg", 20, 1800, 0, 0);
    var star8 = obj("./texture/j012.jpg", 25, 2000, 0, 0);
    var ring8 = ring2("./texture/ring5.png", 40, 5, 2000, 0, 0);
    var star9 = obj("./texture/j030.jpg", 15, 2300, 0, 0);
    const starball = new THREE.TextureLoader().load("img/ball.png");
    var meteoriteball = new THREE.TextureLoader().load("img/star0.png");
    var meteoritetail = new THREE.TextureLoader().load("img/start0.png");
    
    var meteoriteballr = new THREE.TextureLoader().load("img/star00.png");
    var meteoritetailr = new THREE.TextureLoader().load("img/start00.png");






    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xa000000);
      camera = new THREE.PerspectiveCamera(
        45, // fov 45 degree
        window.innerWidth / window.innerHeight, //aspect (width/height ratio)
        0.5, //near
        10000 // far
      );

      particles = new Array();
      randomstar = new Array();
      var material = new THREE.SpriteMaterial({
        map: starball,
        color: 0xffffff,
      });
      var i = 0;
      for (var ix = 0; ix < AMOUNTX; ix++) {
        for (var iy = 0; iy < AMOUNTY; iy++) {
          for (var iz = 0; iz < AMOUNTZ; iz++) {
            particle = particles[i] = new THREE.Sprite(material);
            randomstar[i]=i;
            i++;
            particle.position.x = ix * SEPARATION - (AMOUNTX * SEPARATION) / 2+ (Math.random() * SEPARATION) / 2;
            particle.position.z = iy * SEPARATION - (AMOUNTY * SEPARATION) / 2+ (Math.random() * SEPARATION) / 2;
            particle.position.y = iz * SEPARATION - (AMOUNTZ * SEPARATION) / 2+ (Math.random() * SEPARATION) / 2;
            scene.add(particle);
          }
        }
      }

      camera.position.set(cameraPosition.x, cameraPosition.y, cameraPosition.z);
      camera.lookAt(cameraDirection.x, cameraDirection.y, cameraDirection.z);

      scene.add(camera);

      document.addEventListener("mousemove", mouseMove, false);

      var onKeyDown = function (e) {
        switch (e.keyCode) {
          case 87:
          case 38:
            moveForward = true;
            break;

          case 83:
          case 40:
            moveBackward = true;
            break;

          case 65:
          case 37:
            moveLeft = true;
            break;

          case 68:
          case 39:
            moveRight = true;
            break;

          case 16:
            fast = true;
            break;

          case 27:
            esc = !esc;
            break;
          
          case 80:
            speedup=true;
            break;
          
          case 79:
            speeddown=true;
            break;
                    
          case 32:
            if(meteorites.length<10)addmet=true;
            break;
        }
      };

      var onKeyUp = function (e) {
        switch (e.keyCode) {
          case 87:
          case 38:
            moveForward = false;
            break;

          case 83:
          case 40:
            moveBackward = false;
            break;

          case 65:
          case 37:
            moveLeft = false;
            break;

          case 68:
          case 39:
            moveRight = false;
            break;

          case 16:
            fast = false;
            break;

          case 80:
            speedup=false;
            break;
          
          case 79:
            speeddown=false;
            break;


        }
      };

      document.addEventListener("keydown", onKeyDown, false);
      document.addEventListener("keyup", onKeyUp, false);

      scene.add(new THREE.AmbientLight(0x181818));

      const light = new THREE.PointLight(0xffdd88, 2.5, 5000);

      const textureFlare0 = new THREE.TextureLoader().load(
        "img/lensflare0.png"
      );
      const textureFlare0a = new THREE.TextureLoader().load(
        "img/lensflare0a.png"
      );

      const lensflare = new Lensflare();

      lensflare.addElement(new LensflareElement(textureFlare0a, 4500, 0));
      lensflare.addElement(new LensflareElement(textureFlare0, 1500, 0));

      light.add(lensflare);
      scene.add(light);

      scene.add(sunbackground);
      scene.add(sunbackground1);
      scene.add(sun);
      scene.add(star1);
      scene.add(star2);
      scene.add(star3);
      scene.add(starlite3);
      scene.add(star4);
      scene.add(ring4);
      scene.add(star5);
      scene.add(star6);
      scene.add(starlite6);
      scene.add(star7);
      scene.add(star8);
      scene.add(ring8);
      scene.add(star9);
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      document.getElementById("container").appendChild(renderer.domElement);
      document.body.appendChild(renderer.domElement);
    }
    init();

    function obj_lighting(url, size, x, y, z) {
      var startTexture = THREE.ImageUtils.loadTexture(url);
      var starBall = new THREE.Mesh(
        new THREE.SphereGeometry(size, size*5, size*5),
        new THREE.MeshStandardMaterial({
          emissive: 0xffffff,
          emissiveMap: startTexture,
        })
      );
      starBall.position.set(x, y, z);
      return starBall;
    }
    function obj(url, size, x, y, z) {
      var startTexture = THREE.ImageUtils.loadTexture(url);
      var starBall = new THREE.Mesh(
        new THREE.SphereGeometry(size, size * 5, size * 5),
        new THREE.MeshLambertMaterial({
          map: startTexture,
        })
      );
      starBall.position.set(x, y, z);
      return starBall;
    }

    function ring1(url, size, width, x, y, z) {
      var startTexture = THREE.ImageUtils.loadTexture(url);
      var starBall = new THREE.Mesh(
        new THREE.RingGeometry(size, size + width, size * 5),
        new THREE.MeshLambertMaterial({
          map: startTexture,
          side: THREE.DoubleSide,
        })
      );
      starBall.rotation.x = -Math.PI / 2;
      starBall.rotation.y = -Math.PI / 12;
      starBall.position.set(x, y, z);
      return starBall;
    }
    function ring2(url, size, width, x, y, z) {
      var startTexture = THREE.ImageUtils.loadTexture(url);
      var starBall = new THREE.Mesh(
        new THREE.RingGeometry(size, size + width, size * 5),
        new THREE.MeshLambertMaterial({
          map: startTexture,
          side: THREE.DoubleSide,
        })
      );
      starBall.rotation.x = -Math.PI / 2;
      starBall.rotation.y = -Math.PI / 6;
      starBall.position.set(x, y, z);
      return starBall;
    }

    function renderTuxinghuan(texture) {
      let geom = new THREE.RingGeometry(16, 24, 50, 10, 0, Math.PI * 2);
      let mate = new THREE.MeshLambertMaterial({
        emissive: 0xaa8766,
        transparent: false,
        opacity: 0.8,
        map: texture,
        side: THREE.DoubleSide,
      });
      let ring = new THREE.Mesh(geom, mate);
      ring.rotation.x = -Math.PI / 2;
      ring.rotation.y = -Math.PI / 12;
      return ring;
    }

    // Mouse Move
    var delta = 0;
    var mouseP = { x: 0, y: 0 };
    var up = 0;
    var down = 0;
    var left = 0;
    var right = 0;
    function getMousePosition(e) {
      var x = e.clientX;
      var y = e.clientY;
      return { x: x, y: y };
    }
    function mouseMove(e) {
      if (esc)
        var mouseP = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
      else var mouseP = getMousePosition(e);
      if (mouseP["y"] / window.innerHeight < 0.42) {
        up = 0.42 - mouseP["y"] / window.innerHeight;
      } else {
        up = 0;
      }
      if (mouseP["y"] / window.innerHeight > 0.58) {
        down = mouseP["y"] / window.innerHeight - 0.58;
      } else {
        down = 0;
      }
      if (mouseP["x"] / window.innerWidth < 0.45) {
        left = 0.45 - mouseP["x"] / window.innerWidth;
      } else {
        left = 0;
      }
      if (mouseP["x"] / window.innerWidth > 0.55) {
        right = mouseP["x"] / window.innerWidth - 0.55;
      } else {
        right = 0;
      }
    }

    var maxSpeed = 2;
    var acc = 5;
    var currentSpeedForward = 0;
    var currentSpeedRight = 0;
    var Forward = true;
    var Right = true;
    const clock = new THREE.Clock();
    var angleX = 0;
    var angleY = 0;
    var angleZX = 0;
    var angleZY = 0;

    function bounder_detect() {
      cameraPosition.x = Math.max(-3000, Math.min(3000, cameraPosition.x));
      cameraPosition.z = Math.max(-3000, Math.min(3000, cameraPosition.z));
      cameraPosition.y = Math.max(-1000, Math.min(1000, cameraPosition.y));
    }

    function operation_method_1() {
      if (
        display != "none" &&
        document.getElementById("esc").style.display == "none"
      ) {
        esc = false;
        display = document.getElementById("content").style.display;
      }
      if (fast) maxSpeed = 6;
      else maxSpeed = 2;

      var delta = clock.getDelta();

      // Mouse Move

      if (moveForward && !moveBackward) {
        if (!Forward && currentSpeedForward != 0) {
          cameraPosition.z -= cameraDirection.z * currentSpeedForward;
          cameraPosition.y -= cameraDirection.y * currentSpeedForward;
          cameraPosition.x -= cameraDirection.x * currentSpeedForward;
          currentSpeedForward = Math.max(0, currentSpeedForward - delta * acc);
        } else {
          cameraPosition.z += cameraDirection.z * currentSpeedForward;
          cameraPosition.y += cameraDirection.y * currentSpeedForward;
          cameraPosition.x += cameraDirection.x * currentSpeedForward;
          currentSpeedForward = Math.min(
            maxSpeed,
            currentSpeedForward + delta * acc
          );
          Forward = true;
        }
      } else if (moveBackward && !moveForward) {
        if (Forward && currentSpeedForward != 0) {
          cameraPosition.z += cameraDirection.z * currentSpeedForward;
          cameraPosition.y += cameraDirection.y * currentSpeedForward;
          cameraPosition.x += cameraDirection.x * currentSpeedForward;
          currentSpeedForward = Math.max(0, currentSpeedForward - delta * acc);
        } else {
          cameraPosition.z -= cameraDirection.z * currentSpeedForward;
          cameraPosition.y -= cameraDirection.y * currentSpeedForward;
          cameraPosition.x -= cameraDirection.x * currentSpeedForward;
          currentSpeedForward = Math.min(
            maxSpeed,
            currentSpeedForward + delta * acc
          );
          Forward = false;
        }
      }

      if (moveRight && !moveLeft) {
        if (!Right && currentSpeedRight != 0) {
          cameraPosition.x += cameraDirection.z * currentSpeedRight;
          cameraPosition.z -= cameraDirection.x * currentSpeedRight;
          currentSpeedRight = Math.max(0, currentSpeedRight - delta * acc);
        } else {
          cameraPosition.x -= cameraDirection.z * currentSpeedRight;
          cameraPosition.z += cameraDirection.x * currentSpeedRight;
          currentSpeedRight = Math.min(
            maxSpeed,
            currentSpeedRight + delta * acc
          );
          Right = true;
        }
      } else if (moveLeft && !moveRight) {
        if (Right && currentSpeedRight != 0) {
          cameraPosition.x -= cameraDirection.z * currentSpeedRight;
          cameraPosition.z += cameraDirection.x * currentSpeedRight;
          currentSpeedRight = Math.max(0, currentSpeedRight - delta * acc);
        } else {
          cameraPosition.x += cameraDirection.z * currentSpeedRight;
          cameraPosition.z -= cameraDirection.x * currentSpeedRight;
          currentSpeedRight = Math.min(
            maxSpeed,
            currentSpeedRight + delta * acc
          );
          Right = false;
        }
      }
      if ((!moveBackward && !moveForward) || (moveBackward && moveForward)) {
        if (Forward) {
          cameraPosition.z += cameraDirection.z * currentSpeedForward;
          cameraPosition.y += cameraDirection.y * currentSpeedForward;
          cameraPosition.x += cameraDirection.x * currentSpeedForward;
          currentSpeedForward = Math.max(0, currentSpeedForward - delta * acc);
        } else {
          cameraPosition.z -= cameraDirection.z * currentSpeedForward;
          cameraPosition.y -= cameraDirection.y * currentSpeedForward;
          cameraPosition.x -= cameraDirection.x * currentSpeedForward;
          currentSpeedForward = Math.max(0, currentSpeedForward - delta * acc);
        }
      }
      if ((!moveRight && !moveLeft) || (moveRight && moveLeft)) {
        if (Right) {
          cameraPosition.x -= cameraDirection.z * currentSpeedRight;
          cameraPosition.z += cameraDirection.x * currentSpeedRight;
          currentSpeedRight = Math.max(0, currentSpeedRight - delta * acc);
        } else {
          cameraPosition.x += cameraDirection.z * currentSpeedRight;
          cameraPosition.z -= cameraDirection.x * currentSpeedRight;
          currentSpeedRight = Math.max(0, currentSpeedRight - delta * acc);
        }
      }

      angleX += left / 8.5 / Math.PI - right / 8.5 / Math.PI;
      cameraDirection.x -= Math.sin(angleX);
      cameraDirection.z -= Math.cos(angleX);

      if (cameraDirection.y < 0.75) {
        angleY += up / 20 / Math.PI;
      }
      if (cameraDirection.y > -0.75) {
        angleY -= down / 20 / Math.PI;
      }
      cameraDirection.y += Math.sin(angleY) * 2;
      cameraDirection.normalize();
    }

    function shuffleArray(array) {
      for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
      }
    }

    shuffleArray(randomstar);
    var angle = 0;
    document.getElementById("plantspeed").innerHTML=Math.floor(rotatespeed*2);
    
    document.getElementById("meteorite").innerHTML=meteorites.length+"/10";





function generate_meteoritegroup(size){
  var osize=size;
    var material = new THREE.SpriteMaterial({
        map: meteoriteball,
        color: 0xffffff,
      });
      var materialr = new THREE.SpriteMaterial({
        map: meteoriteballr,
        color: 0xffffff,
      });
      var material1 = new THREE.SpriteMaterial({
        map: meteoritetail,
        color: 0xffffff,
      });
      
      var material1r = new THREE.SpriteMaterial({
        map: meteoritetailr,
        color: 0xffffff,
      });
      
    var meteoritegroup = new THREE.Object3D();

    var ran=Math.random()*3;
    var x,y,z;
    if(ran>2){
      if(ran>2.5)x=10000;
      else x=-10000;
      y=(Math.random()-0.5)*20000;
      z=(Math.random()-0.5)*20000;
    }
    else if(ran>1){
      if(ran>1.5)y=10000;
      else y=-10000;
      x=(Math.random()-0.5)*20000;
      z=(Math.random()-0.5)*20000;
    }
    else{
      if(ran>0.5)z=10000;
      else z=-10000;
      y=(Math.random()-0.5)*20000;
      x=(Math.random()-0.5)*20000;
    }
    
    var v1=new THREE.Vector3(Math.random()-0.5,Math.random()-0.5,Math.random()-0.5).normalize();
    while(new THREE.Vector3(-x,-y,-z).normalize().dot(v1)<0.7||new THREE.Vector3(-x,-y,-z).normalize().dot(v1)>0.9){
      v1=new THREE.Vector3(Math.random()-0.5,Math.random()-0.5,Math.random()-0.5).normalize();
    }


    for(var i=0;i<6;i++){
      if(i%2==0)var meteorite=new THREE.Sprite(material);
      else var meteorite=new THREE.Sprite(materialr);
      meteorite.position.set(x,y,z);
      meteorite.scale.set(size*1.35, size*1.35, 1)
      meteoritegroup.add(meteorite)
      x=x-size*v1.x/20;
      y=y-size*v1.y/20;
      z=z-size*v1.z/20;
      size*=0.99;
    }

    var num=6;
    while(size>osize*0.01){
      if(size<osize*0.8)num=2
      for(i=0;i<num;i++){
        
      if(i%2==0)var meteorite=new THREE.Sprite(material1);
      else var meteorite=new THREE.Sprite(material1r);
      meteorite.position.set(x-size*v1.x*Math.random()/5,y-size*v1.y*Math.random()/5,z-size*v1.z*Math.random()/5);
      meteorite.scale.set(size*0.99, size*0.99, 1)
      meteoritegroup.add(meteorite)
    }
      x=x-size*v1.x/20;
      y=y-size*v1.y/20;
      z=z-size*v1.z/20;
      size*=0.993;
    }

    return [meteoritegroup,v1];

}

function meteorite_move(meteorite1){
      meteorite1[0].position.x+=meteorite1[1].x*20;
      meteorite1[0].position.y+=meteorite1[1].y*20;
      meteorite1[0].position.z+=meteorite1[1].z*20;
      var mlen=meteorite1[0].children.length;
      for(var m=0;m<mlen;m++){
        if(Math.random()<0.7)continue;
        var met=meteorite1[0].children[m];
        var x=met.position.x;
        var y=met.position.y;
        var z=met.position.z;
        var size=met.scale.x;
        var v1=meteorite1[1];
        met.position.set(x-size*v1.x*(Math.random()-0.5)/50,y-size*v1.y*(Math.random()-0.5)/50,z-size*v1.z*(Math.random()-0.5)/50);
      }
      if(meteorite1[0].position.x*meteorite1[0].position.x+meteorite1[0].position.y*meteorite1[0].position.y+meteorite1[0].position.z*meteorite1[0].position.z>20000*20000){
        scene.remove(meteorite1[0]);
      return true;
    }else{
      return false;}
}


    function animate() {
      if(addmet){
        var meteorite1=generate_meteoritegroup(50*(Math.random()*0.6+0.7));
        meteorites.push(meteorite1);
        scene.add(meteorite1[0]);
        addmet=false;
        document.getElementById("meteorite").innerHTML=meteorites.length+"/10";
      }
      for(var met in meteorites){
        if(meteorite_move(meteorites[met]))meteorites.splice(met,1);
        document.getElementById("meteorite").innerHTML=meteorites.length+"/10";
      }

      var rotate=angle * Math.PI * rotatespeed;
      if(speedup){rotatespeed=Math.min(rotatespeed*1.0101010101,50);
        document.getElementById("plantspeed").innerHTML=Math.floor(rotatespeed*2);
        if(rotatespeed<50)angle *= 0.99}
      if(speeddown){rotatespeed=Math.max(rotatespeed*0.99,0.5);
        document.getElementById("plantspeed").innerHTML=Math.floor(rotatespeed*2);
        if(rotatespeed>0.5)angle *= 1.0101010101}

      angle += 0.0005;

      sun.rotation.y -= (0.005 / Math.PI) * rotatespeed/5;

      var position1 = 2 * rotate/5;
      star1.rotateOnWorldAxis(
        new THREE.Vector3(-1, 1, 0).normalize(),
        (0.2 / Math.PI) * rotatespeed/5
      );
      star1.position.x = Math.sin(position1) * 200;
      star1.position.z = Math.cos(position1) * 200;

      var position2 = 1.2 * rotate/5;
      star2.rotateOnWorldAxis(
        new THREE.Vector3(-1, 2, 1).normalize(),
        (0.02 / Math.PI) * rotatespeed/5
      );
      star2.position.x = Math.sin(position2) * 300;
      star2.position.z = Math.cos(position2) * 300;

      var position3 = 1.5 * rotate/5;
      star3.rotateOnWorldAxis(
        new THREE.Vector3(-1, 1, 1).normalize(),
        (0.04 / Math.PI) * rotatespeed/5
      );
      star3.position.x = Math.sin(position3) * 500;
      star3.position.z = Math.cos(position3) * 500;
      var position3 = 10 * rotate/5;
      starlite3.rotateOnWorldAxis(
        new THREE.Vector3(-1, 1, 1.5).normalize(),
        (0.4 / Math.PI) * rotatespeed/5
      );
      starlite3.position.x = Math.sin(position3) * 25 + star3.position.x;
      starlite3.position.z = Math.cos(position3) * 25 + star3.position.z;
      starlite3.position.y = Math.sin(position3) * 30 + star3.position.y;

      var position4 = -0.7 * rotate/5;
      star4.rotateOnWorldAxis(
        new THREE.Vector3(0, 1, 0).normalize(),
        (0.06 / Math.PI) * rotatespeed/5
      );
      star4.position.x = Math.cos(position4) * 800;
      star4.position.z = Math.sin(position4) * 800;
      ring4.rotateOnWorldAxis(
        new THREE.Vector3(0, 1, 0).normalize(),
        ((0.7 * 0.0005) / Math.PI) * rotatespeed/5 * 10
      );
      ring4.position.x = Math.cos(position4) * 800;
      ring4.position.z = Math.sin(position4) * 800;

      var position5 = 0.5 * rotate/5;
      star5.rotateOnWorldAxis(
        new THREE.Vector3(1, 4, 1).normalize(),
        (0.03 / Math.PI) * rotatespeed/5
      );
      star5.position.x = Math.sin(position5) * 1100;
      star5.position.z = Math.cos(position5) * 1100;

      var position6 = 0.3 * rotate/5;
      star6.rotateOnWorldAxis(
        new THREE.Vector3(0, 5, 1).normalize(),
        (0.02 / Math.PI) * rotatespeed/5
      );
      star6.position.x = Math.sin(position6) * 1500;
      star6.position.z = Math.cos(position6) * 1500;
      position6 = 2 * rotate/5;
      starlite6.rotateOnWorldAxis(
        new THREE.Vector3(1, 1, 1.5).normalize(),
        (0.2 / Math.PI) * rotatespeed/5
      );
      starlite6.position.x = Math.sin(position6) * 55 + star6.position.x;
      starlite6.position.z = Math.cos(position6) * 55 + star6.position.z;
      starlite6.position.y = Math.sin(position6) * 30 + star6.position.y;

      var position7 = 0.4 * rotate/5;
      star7.rotateOnWorldAxis(
        new THREE.Vector3(0.5, 3, 1).normalize(),
        (0.015 / Math.PI) * rotatespeed/5
      );
      star7.position.x = Math.sin(position7) * 1800;
      star7.position.z = Math.cos(position7) * 1800;

      var position8 = -0.2 * rotate/5;
      star8.rotateOnWorldAxis(
        new THREE.Vector3(0, 1, 0).normalize(),
        (0.1 / Math.PI) * rotatespeed/5
      );
      star8.position.x = Math.cos(position8) * 2000;
      star8.position.z = Math.sin(position8) * 2000;
      ring8.rotateOnWorldAxis(
        new THREE.Vector3(0, 1, 0).normalize(),
        ((0.2 * 0.0005) / Math.PI) * rotatespeed/5 * 10
      );
      ring8.position.x = Math.cos(position8) * 2000;
      ring8.position.z = Math.sin(position8) * 2000;

      var position9 = 0.1 * rotate/5;
      star9.rotateOnWorldAxis(
        new THREE.Vector3(0, 10, 1).normalize(),
        (0.01 / Math.PI) * rotatespeed/5
      );
      star9.position.x = Math.sin(position9) * 2300;
      star9.position.z = Math.cos(position9) * 2300;

      //Ball Maving
      var i = 0;
      for (var ix = 0; ix < AMOUNTX; ix++) {
        for (var iy = 0; iy < AMOUNTY; iy++) {
          for (var iz = 0; iz < AMOUNTZ; iz++) {
            var x = 0;
            var z = 0;
            var y = 0;
            particle = particles[randomstar[i]];
            i++;
            var sin_ix_2 = Math.sin((ix + count*0.5) * 0.3);
            var sin_iy_2 = Math.sin((iy + count*0.5) * 0.5);
            var sin_iz_2 = Math.sin((iz + count*0.5) * 0.4);
            var sin_i = Math.sin((i + count * 10) * 0.5)*3;
            var dis = Math.sqrt(
                Math.pow(x - particle.position.x, 2) +
                Math.pow(z - particle.position.z, 2) +
                Math.pow(y - particle.position.y, 2)
            );

            var xyz =
              ((sin_ix_2 + sin_iy_2 + sin_iz_2) * Math.max(dis, 1200)) / 20000;

            if(i%8>=4)particle.position.y += xyz*(i%17)/11;
            else particle.position.y -= xyz*(i%17)/11;

            if(i%4>=2)particle.position.x += xyz*(i%13)/9;
            else particle.position.x -= xyz*(i%13)/9;

            if(i%2==0)particle.position.z += xyz*(i%11)/7;
            else particle.position.z += xyz*(i%11)/7;

            particle.scale.x = particle.scale.y = Math.max(
              sin_i + 3,
              1.25
            );
          }
        }
      }
      count += 0.005;

      operation_method_1();
      bounder_detect();
      camera.position.set(cameraPosition.x, cameraPosition.y, cameraPosition.z);
      camera.lookAt(
        cameraPosition.x + cameraDirection.x,
        cameraPosition.y + cameraDirection.y,
        cameraPosition.z + cameraDirection.z
      );
      camera.updateProjectionMatrix();
      // spotLight.rotation.x+=0.01;
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }

    animate();
    var MyResize = function () {
      //get the new sizes
      var width = window.innerWidth;
      var height = window.innerHeight;
      //then update the renderer
      renderer.setSize(width, height);
      //and update the aspect ratio of the camera
      camera.aspect = width / height;

      //update the projection matrix given the new values
      camera.updateProjectionMatrix();

      //and finally render the scene again
      renderer.render(scene, camera);
    };
    window.addEventListener("resize", MyResize);
  </script>
  <script>
    function hideMe() {
      document.getElementById("esc").style.display = "none";
      $("#content").fadeOut(1500);
      $("#blocker").fadeOut(1500);
      $("#secondBlocker").delay(1200).fadeIn(1000);
    }
  </script>
</html>
